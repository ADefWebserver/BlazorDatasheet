@page "/"
@using BlazorDatasheet.Model
@using BlazorDatasheet.Server.Data
@using Range = BlazorDatasheet.Model.Range
@using BlazorDatasheet.Icons
@using BlazorDatasheet.ObjectEditor

<PageTitle>Index</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<SurveyPrompt Title="How is Blazor working for you?"/>

<p>Here is out ObjectEditor with properties across the columns</p>

<p>
    <input id="readonly" type="checkbox" @bind="IsSheetReadOnly"/>
    <label for="readonly">Sheet readonly</label>
</p>

<Datasheet Sheet="Sheet" IsReadOnly="IsSheetReadOnly"></Datasheet>

@code{

    private Sheet Sheet;
    private List<Person> People { get; set; }
    private bool IsSheetReadOnly { get; set; }

    protected override void OnInitialized()
    {
        People = new List<Person>()
        {
            new Person() { Id = 0, Age = 32, FirstName = "John", LastName = "Citizen" },
            new Person() { Id = 1, Age = 49, FirstName = "Albert", LastName = "Rogers" },
            new Person() { Id = 2, Age = 106, FirstName = "Wendall", LastName = "Palmer" },
        };

        var random = new Random();
        for (int i = 0; i < 100; i++)
        {
            People.Add(new Person() { Id = i, Age = random.NextInt64(100), FirstName = "Person", LastName = "Person" });
        }

        var checkCf = new ConditionalFormat((cell, cells) => { return ((Person)cell.Data).Checked == true; }, new Format()
        {
            BackgroundColor = "#D9F8C4"
        });

        var ageCf = new ConditionalFormat((cell, cells) => { return ((Person)cell.Data).Age > 50; }, new Format()
        {
            ForegroundColor = "#F37878"
        });

        var builder1 = new ObjectEditorBuilder<Person>(People, GridDirection.PropertiesAcrossColumns);
        builder1.AutogenerateProperties(true)
                .WithProperty(x => x.FirstName, pd =>
                {
                    pd.Heading = "First Name";
                    pd.Setter = (person, s) => { person.FirstName = s; };
                    pd.Format = new Format()
                    {
                        FontWeight = "bold",
                        ForegroundColor = "#006600",
                        BackgroundColor = "#fafafa",
                    };
                    pd.UseConditionalFormat("ageCf");
                    pd.UseConditionalFormat("check");
                    pd.IsReadOnly = true;
                })
                .WithProperty(x => x.Id, pd => { pd.Heading = "Person ID"; })
                .WithConditionalFormat("check", checkCf)
                .WithConditionalFormat("ageCf", ageCf)
                .WithProperty(x => x.Checked, pd => { pd.UseConditionalFormat("check"); });

        var editor1 = builder1.Build();


        Sheet = editor1.Sheet;
    }

}